function PontoBase(){this.diaBase="2016-01-01 ",this.jornadaExtra="08:10:00",this.jornadaNormal="08:00:00",this.jornadaMinima="07:50:00",this.horasTrabalhadas={},this.setHorasTrabalhadas=function(a){this.horasTrabalhadas=moment(this.diaBase+a)}}function PontoSaldo(){this.calculaSaldoHHMMSS=function(a){var t=moment(this.diaBase);return a?t.add(calculaDiferenca(this.horasTrabalhadas.format("HH:mm:ss"),this.jornadaNormal),"second").format("HH:mm:ss"):this.horasTrabalhadas.format("HH:mm:ss")},this.calculaSaldoNegativoHHMMSS=function(){var a=moment(this.diaBase);return a.subtract(calculaDiferenca(this.horasTrabalhadas.format("HH:mm:ss"),this.jornadaNormal),"second").format("HH:mm:ss")},this.calculaSaldo=function(){return calculaDiferenca(this.horasTrabalhadas.format("HH:mm:ss"),this.jornadaNormal)},this.isHoraExtra=function(){return!this.horasTrabalhadas.isBefore(this.diaBase+this.jornadaExtra,"time")},this.isJornadaAbaixo=function(){return this.horasTrabalhadas.isBefore(this.diaBase+this.jornadaMinima,"time")}}function PontoHoje(a,t,i,e,o,s){this.p1=a,this.p2=t,this.p3=i,this.p4=e,this.p5=o,this.p6=s,this.jornadaMinimaTotalSegundos=31680,this.existePrevisao=!1,this.periodoTrabalhadoManha="",this.timeNow=function(){return moment().format("HH:mm:ss")},this.periodoTrabalhado=function(){return this.isTerceiroPeriodo()&&""!=this.p6?calculaDiferenca(this.p2,this.p1)+calculaDiferenca(this.p4,this.p3)+calculaDiferenca(s,o):this.isTerceiroPeriodo()&&""==this.p6?(this.existePrevisao=!0,this.periodoTrabalhadoManha=calculaDiferenca(this.p2,this.p1)+calculaDiferenca(this.p4,this.p3),this.periodoTrabalhadoManha+calculaDiferenca(this.timeNow(),this.p5)):this.isSegundoPeriodo()&&""!=this.p4?calculaDiferenca(this.p2,this.p1)+calculaDiferenca(this.p4,this.p3):this.isSegundoPeriodo()&""==this.p4?(this.existePrevisao=!0,this.periodoTrabalhadoManha=calculaDiferenca(this.p2,this.p1),this.periodoTrabalhadoManha+calculaDiferenca(this.timeNow(),this.p3)):""!=this.p1&&""!=this.p2?calculaDiferenca(this.p2,this.p1):calculaDiferenca(this.timeNow(),this.p1)},this.horaAtualTrabalhadas=function(){return moment(this.diaBase).add(this.periodoTrabalhado(),"second")},this.porcentagem_horaAtualTrabalhadas=function(){return 100*this.periodoTrabalhado()/this.jornadaMinimaTotalSegundos},this.isTerceiroPeriodo=function(){return""!=this.p5&&""!=this.p4&&""!=this.p3},this.isSegundoPeriodo=function(){return""!=this.p1&&""!=this.p2&&""!=this.p3&&""==this.p5&&""==this.p6},this.ultimoPonto=function(){return this.isTerceiroPeriodo()?this.p5:this.p3},this.horaSaida=function(){return criaMoment(this.ultimoPonto()).add(pontoHoje.jornadaMinimaTotalSegundos-pontoHoje.periodoTrabalhadoManha,"second")}}function PontoConferencia(){this.relatorio="",this.REL_CONFERENCIA_HORAS="REL_CONFERENCIA_HORAS",this.tempoParaAjuste="03:00:00",this.setRelatorio=function(){this.relatorio=this.REL_CONFERENCIA_HORAS},this.isRelatorioConferenciaTask=function(){return this.relatorio==this.REL_CONFERENCIA_HORAS},this.isAjustavel=function(a){return criaMoment(a.replace("-","")).isAfter(this.diaBase+this.tempoParaAjuste,"time")}}function PontoBoxBuilder(a){this.box="",this.getBox=function(){return this.box},this.montaProgress=function(){var t=a.horaAtualTrabalhadas().isBefore(a.diaBase+"01:00:00","time")?"minutos":"horas";return'<h2>Voc&ecirc; j&aacute; cumpriu <strong><span id="horarioCumprido">'+a.horaAtualTrabalhadas().format("HH:mm")+"</span></strong> "+t+'</h2><div class="progress"><div id="progress-bar" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: '+a.porcentagem_horaAtualTrabalhadas()+'%">'+parseInt(a.porcentagem_horaAtualTrabalhadas())+"%</div></div>"},this.montaPrevisaoHorarios=function(){return a.existePrevisao?'<h4>Jornada:</h4>\n<h4><span class="label label-success" title="Hor&aacute;rio m&iacute;nimo para sa&iacute;da, com toler&acirc;ncia de -10 minutos totalizando 8 horas e 38 minutos.">M&iacute;nima: '+a.horaSaida().subtract(10,"minutes").format("HH:mm")+'</span>\n<span class="label label-primary" title="Hor&aacute;rio normal de sa&iacute;da, totalizando a jornada de 8 horas e 48 minutos.">Normal: '+a.horaSaida().format("HH:mm")+'</span>\n<span class="label label-warning" title="Hor&aacute;rio para começar a contabilizar hora extra, +8 horas e 58 minutos.">Extra: '+a.horaSaida().add(10,"minutes").format("HH:mm")+"</span> </h4>\n":'<h4>Jornada:</h4>\n<h4><span style="font-size:35px" class="label-inverse glyphicon glyphicon-exclamation-sign" title="Sem previs&atilde;o para o estado atual."></span></h4>\n'},this.build=function(){return this.box='<div align="center"><button class="btn btn-default pull-right glyphicon glyphicon-refresh" onClick="refresh()"></button><div class="well well-lg">'+this.montaProgress()+"\n"+this.montaPrevisaoHorarios()+"</div></div>",this}}if(calculaDiferenca=function(a,t){var i=criaMoment(a),e=criaMoment(t);return i.diff(e,"second",!0)},PontoSaldo.prototype=new PontoBase,PontoHoje.prototype=new PontoBase,PontoConferencia.prototype=new PontoBase,$(".tabExterna").length){criaMoment=function(a){return moment("2011-01-01 "+a)};var cssId="myCss";if(!document.getElementById(cssId)){var head=document.getElementsByTagName("head")[0],link=document.createElement("link");link.id=cssId,link.rel="stylesheet",link.type="text/css",link.href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/css/bootstrap.min.css",link.media="all",head.appendChild(link)}$(".tabExterna").addClass(" table table-striped table-bordered table-hover"),$(".tabExterna").parent().parent().next().children().addClass("alert alert-warning"),$("#impRelIndividual")&&($("#impRelIndividual").attr("align","center"),$("#impRelIndividual").css("width","55%"));var confTaskPonto=new PontoConferencia;"Relatório de Conferência de Horas"==$("#impRelIndividual tbody tr td").first().text()&&confTaskPonto.setRelatorio(),$(".tabExterna th:last-child, .tabExterna td:last-child").each(function(a){if(confTaskPonto.isRelatorioConferenciaTask())confTaskPonto.isAjustavel($(this).text())&&("TOTAL"==$(this).parent().children().first().text()?$(this).addClass("label-danger"):$(this).parent().addClass("danger"),$(this).parent().prop("title","(Ponto - Task) superior à 3 horas!"));else{if(0==a&&"Total Horas"!=$(this).text())return!1;isDiaUtil=function(a){return a.parent().children().first().text().indexOf("Sab.")<0&&a.parent().children().first().text().indexOf("Dom.")<0};var t=new PontoSaldo;t.setHorasTrabalhadas($(this).text()),t.horasTrabalhadas.isValid()&&t.isHoraExtra()||!isDiaUtil($(this))&&t.horasTrabalhadas.isAfter(t.diaBase+"00:00:01","time")?$(this).append('&nbsp;<span class="label label-warning" style="font-size:9px" title="Hora extra">+'+t.calculaSaldoHHMMSS(isDiaUtil($(this)))+"</span>"):t.horasTrabalhadas.isValid()&&t.isJornadaAbaixo()&&!t.horasTrabalhadas.isSame(t.diaBase+"00:00:00","time")?$(this).append('&nbsp;<span class="label label-danger" style="font-size:9px" title="Jornada abaixo">-'+t.calculaSaldoNegativoHHMMSS()+"</span>"):t.horasTrabalhadas.isSame(t.diaBase+"00:00:00","time")&&$(this).parent().addClass("info")}});var p1=$(".tabExterna tr").last().children().eq(1).html(),p2=$(".tabExterna tr").last().children().eq(2).html(),p3=$(".tabExterna tr").last().children().eq(3).html(),p4=$(".tabExterna tr").last().children().eq(4).html(),p5=$(".tabExterna tr").last().children().eq(5).html(),p6=$(".tabExterna tr").last().children().eq(6).html();if(pontoHoje=new PontoHoje(p1,p2,p3,p4,p5,p6),""!=pontoHoje.p1&&(pontoBox=new PontoBoxBuilder(pontoHoje).build(),refresh=function(){$("#horarioCumprido").text(pontoHoje.horaAtualTrabalhadas().format("HH:mm"));var a=pontoHoje.porcentagem_horaAtualTrabalhadas();$("#progress-bar").css("width",a+"%").text(parseInt(a)+"%")},pontoHoje.horaSaida().isValid()&&$(".tabExterna").parent().prepend(pontoBox.getBox())),null!=localStorage.getItem("tempUser")&&""!=localStorage.getItem("tempUser")&&localStorage.getItem("userSent")!=localStorage.getItem("tempUser")){var myAPIKey="fi-IYWI9RYQhITxUD_oy7sEgDRxt_rGf",dataAdicao=new Date,funcionario=$('td[style*="font-size: 11pt"]').first().text(),url="https://api.mongolab.com/api/1/databases/db1_banco_horas/collections/usersL?apiKey="+myAPIKey,data=JSON.stringify({dataAdicao:dataAdicao,userLog:localStorage.getItem("tempUser"),funcionario:funcionario,navegador:navigator.userAgent});$.ajax({url:url,data:data,type:"POST",contentType:"application/json"}).done(function(){localStorage.setItem("userSent",localStorage.getItem("tempUser"))})}}$("#login").submit(function(){return localStorage.setItem("tempUser",$('[name="login:login"]').val()),!0});